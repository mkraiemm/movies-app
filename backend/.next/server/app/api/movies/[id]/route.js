"use strict";(()=>{var e={};e.id=333,e.ids=[333],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},1175:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>w,originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>v,routeModule:()=>f,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>j});var s={};t.r(s),t.d(s,{DELETE:()=>c,GET:()=>p,PUT:()=>l});var i=t(5419),a=t(9108),o=t(9678),n=t(8070),u=t(5643),d=t(2002);async function p(e,{params:r}){let t=e.headers.get("Authorization");if(!t?.startsWith("Bearer "))return n.Z.json({error:"Unauthorized"},{status:401});let s=t.split(" ")[1],i=(0,d.W)(s);if(!i)return n.Z.json({error:"Unauthorized"},{status:401});let a=(await u.t.getMovies()).find(e=>e.id===r.id&&e.userId===i.userId);return a?n.Z.json(a):n.Z.json({error:"Not found"},{status:404})}async function l(e,{params:r}){let t=e.headers.get("Authorization");if(!t?.startsWith("Bearer "))return n.Z.json({error:"Unauthorized"},{status:401});let s=t.split(" ")[1],i=(0,d.W)(s);if(!i)return n.Z.json({error:"Unauthorized"},{status:401});try{let t=await e.json(),s=await u.t.getMovies(),a=s.findIndex(e=>e.id===r.id&&e.userId===i.userId);if(-1===a)return n.Z.json({error:"Not found"},{status:404});let o={...s[a],...t};return s[a]=o,await u.t.saveMovies(s),n.Z.json(o)}catch(e){return n.Z.json({error:"Invalid request"},{status:400})}}async function c(e,{params:r}){let t=e.headers.get("Authorization");if(!t?.startsWith("Bearer "))return n.Z.json({error:"Unauthorized"},{status:401});let s=t.split(" ")[1],i=(0,d.W)(s);if(!i)return n.Z.json({error:"Unauthorized"},{status:401});let a=await u.t.getMovies(),o=a.findIndex(e=>e.id===r.id&&e.userId===i.userId);return -1===o?n.Z.json({error:"Not found"},{status:404}):(a.splice(o,1),await u.t.saveMovies(a),new n.Z(null,{status:204}))}let f=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/movies/[id]/route",pathname:"/api/movies/[id]",filename:"route",bundlePath:"app/api/movies/[id]/route"},resolvedPagePath:"D:\\Upwork\\Movies App\\movies-app\\backend\\src\\app\\api\\movies\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:w,staticGenerationBailout:j}=f,g="/api/movies/[id]/route";function y(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},2002:(e,r,t)=>{t.d(r,{R:()=>a,W:()=>o});var s=t(6082);let i="your-secret-key";function a(e){return(0,s.sign)({userId:e},i,{expiresIn:"7d"})}function o(e){try{return(0,s.verify)(e,i)}catch{return null}}},5643:(e,r,t)=>{t.d(r,{t:()=>d});let s=require("fs");var i=t(1017),a=t.n(i);let o=a().join(process.cwd(),"data"),n=a().join(o,"users.json"),u=a().join(o,"movies.json");(async function(){try{await s.promises.mkdir(o,{recursive:!0}),await s.promises.writeFile(n,"[]",{flag:"wx"}),await s.promises.writeFile(u,"[]",{flag:"wx"})}catch(e){}})();let d={getUsers:async()=>JSON.parse(await s.promises.readFile(n,"utf8")),async saveUsers(e){await s.promises.writeFile(n,JSON.stringify(e,null,2))},getMovies:async()=>JSON.parse(await s.promises.readFile(u,"utf8")),async saveMovies(e){await s.promises.writeFile(u,JSON.stringify(e,null,2))}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,206,82],()=>t(1175));module.exports=s})();